# .github/workflows/deploy-gh-pages.yml
name: ğŸš€ Deploy to GitHub Pages

on:
  # Trigger when love-cron completes successfully
  workflow_run:
    workflows: ["ğŸ Python Love Meter Cron"]
    types:
      - completed
    branches: [main]
  
  # Also trigger manually if needed
  workflow_dispatch:

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
      contents: read
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Get all history
    
      - name: ğŸ” Verify files exist
        run: |
          echo "Checking for required files..."
          ls -la
          echo "---"
          if [ -f "index.html" ]; then
            echo "âœ… index.html exists"
          else
            echo "âŒ index.html missing"
            exit 1
          fi
          if [ -f "result.txt" ]; then
            echo "âœ… result.txt exists"
          else
            echo "âš ï¸ result.txt not found (will be generated by love-cron)"
          fi
    
      - name: ğŸ› ï¸ Setup Pages
        uses: actions/configure-pages@v4
    
      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Upload everything (or specify specific files)
          path: .
          # OR upload only needed files:
          # path: |
          #   index.html
          #   result.txt
          #   README.md
          #   love_result.json
    
      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
